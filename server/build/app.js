!function(e){var t={};function s(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=21)}([function(e,t,s){"use strict";(function(e,r){var a=s(14),n=s.n(a),o=s(7),c=s.n(o),i=s(4),u=s.n(i),l=s(15);const d=c.a.basename(e),p=l.a.production,w={},y=new u.a(p.database,p.username,p.password,{host:p.host,port:p.port,dialect:"mysql",timezone:"+09:00"});n.a.readdirSync(r).filter(e=>0!==e.indexOf(".")&&e!==d&&".js"===e.slice(-3)).forEach(e=>{const t=s(20)(c.a.join(r,e)).default(y,u.a.DataTypes);w[t.name]=t}),Object.keys(w).forEach(e=>{w[e].associate&&w[e].associate(w)}),w.sequelize=y,w.Sequelize=u.a,t.a=w}).call(this,"/index.js","/")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("passport-jwt")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("http-errors")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("fs")},function(e,t,s){"use strict";var r=s(3);if(s.n(r).a.config().error)throw new Error("Could't find .env file ");t.a={development:{host:process.env.DB_HOST,port:process.env.DB_PORT,username:process.env.DB_USERNAME,password:process.env.DB_PASSWORD,database:process.env.DB_DATABASE,dialect:"mysql"},test:{username:"root",password:null,database:"database_production",host:"127.0.0.1",dialect:"mysql"},production:{username:process.env.DB_USERNAME,password:process.env.DB_PASSWORD,database:process.env.DB_DATABASE,host:"127.0.0.1",dialect:"mysql"}}},function(e,t){e.exports=require("passport-github2")},function(e,t){e.exports=require("passport-apple")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("multer-storage-imgur")},function(e,t){function s(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}s.keys=function(){return[]},s.resolve=s,e.exports=s,s.id=20},function(e,t,s){"use strict";s.r(t);var r=s(1),a=s.n(r),n=s(9),o=s.n(n),c=s(10),i=s.n(c),u=s(11),l=s.n(u),d=s(12),p=s.n(d),w=s(2),y=s.n(w),h=s(13),m=s(6),f=s.n(m),g=s(3),b=s.n(g);if(b.a.config().error)throw new Error(" Couldn't find .env file ");var v={saltRounds:+process.env.SALT_ROUNDS};var j=e=>new Promise((t,s)=>{f.a.hash(e,v.saltRounds,(e,s)=>t(s))}),E=(e,t)=>new Promise((s,r)=>{f.a.compare(e,t,(e,t)=>s(t))}),O=s(0);var A=new h.Strategy({usernameField:"userId",passwordField:"password",session:!1},async(e,t,s)=>{const r=await O.a.user.findOne({where:{userId:e}});if(!r)return s(null,!1,{message:"찾는 아이디가 없습니다."});return await E(t,r.password)?s(null,r):s(null,!1,{message:"비밀번호가 다릅니다."})}),S=s(8);if(b.a.config().error)throw new Error(" Couldn't find .env file ");var I={secretOrKey:process.env.JWT_SECRET_KEY,githubClientId:process.env.GITHUB_ID,githubClientSecret:process.env.GITHUB_SECRET,githubCallbackURL:`http://localhost:${process.env.PORT}/${process.env.GITHUB_CALLBACK_URL}`,appleClientId:process.env.APPLE_CLIENT_ID,appleTeamId:process.env.APPLE_TEAM_ID,appleKeyId:process.env.APPLE_KEY_ID,applePrivateKey:process.env.APPLE_PRIVATE_KEY,appleCallbackURL:`http://localhost:${process.env.PORT}/${process.env.APPLE_CALLBACK_URL}`};const _={jwtFromRequest:S.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:I.secretOrKey};var q=new S.Strategy(_,async(e,t)=>{try{const s=await O.a.user.findOne({where:{userId:e.userId,resourceServer:e.resourceServer}});return t(null,s?s:!1)}catch(e){return t(e,!1)}}),R=new(s(16).Strategy)({clientID:I.githubClientId,clientSecret:I.githubClientSecret,callbackURL:I.githubCallbackURL},async(e,t,s,r)=>r(null,await O.a.user.findOrCreate({where:{userId:s.id,resourceServer:s.provider,nickname:s.username,OAuth:!0}}))),k=s(17),x=new(s.n(k).a)({clientID:I.appleClientId,teamID:I.appleTeamId,callbackURL:I.appleCallbackURL,keyID:I.appleKeyId,privateKeyLocation:I.applePrivateKey,passReqToCallback:!0},async(e,t,s,r,a,n)=>n(null,await O.a.user.findOrCreate({where:{userId:a.id,resourceServer:"apple",nickname:a.username,OAuth:!0}})));var D=async e=>!await O.a.user.findOne({where:{userId:e}}),P=async(e,t,s)=>{try{const r=await j(t);return await O.a.user.create({userId:""+e,nickname:""+s,password:""+r,OAuth:!1,resourceServer:"local"})}catch(e){throw new Error(e)}};var C=(e,t,s)=>{const{userId:r,password:a,nickname:n}=e.body;if(r.length<6)return t.status(400).json({message:"아이디는 6자 이상 적어주셔야 합니다."});if(r.length>16)return t.status(400).json({message:"아이디는 16자 이하로 적어주셔야 합니다."});if(n.length<6)return t.status(400).json({message:"닉네임은 6자 이상 적어주셔야 합니다."});if(n.length>16)return t.status(400).json({message:"닉네임 16자 이하로 적어주셔야 합니다."});if(a.length<6)return t.status(400).json({message:"비밀번호는 6자 이상 적어주셔야 합니다."});if(a.length>12)return t.status(400).json({message:"비밀번호는 12자 이하로 적어주셔야 합니다."});const o=/[a-zA-Z0-9]/;return o.test(r)?o.test(n)?/[0-9]/.test(a)&&/[a-zA-Z]/.test(a)&&/[~!@#$%^&*()_+|<>?:{}]/.test(a)?void s():t.status(400).json({message:"비밀번호는 영문자, 숫자, 특수문자로 구성되어야 합니다."}):t.status(400).json({message:"닉네임은 영문과 숫자로만 적어주셔야 합니다."}):t.status(400).json({message:"아이디는 영문과 숫자로만 적어주셔야 합니다."})},B=async(e,t,s)=>{const{userId:r}=e.body;if(!await D(r))return t.status(400).json({message:"아이디가 이미 존재합니다."});s()};var T=(e,t)=>t.status(200),L=async(e,t)=>{const{userId:s,password:r,nickname:a}=e.body;try{const e=await P(s,r,a);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},U=s(5),K=s.n(U);var M=(e,t)=>{y.a.authenticate("local",{session:!1},(s,r,a)=>s||!r?t.status(400).json(a):e.login(r,{session:!1},e=>{e&&t.send(e);const s=K.a.sign(r.toJSON(),I.secretOrKey);return t.json({user:r,token:s})}))(e,t)},z=(e,t)=>{y.a.authenticate("github",{session:!1},(e,s)=>{if(e)return t.status(400).json({message:e});const r=K.a.sign(s[0].toJSON(),I.secretOrKey);return t.status(200).json({user:s,token:r})})(e,t)},F=(e,t)=>{y.a.authenticate("apple",{session:!1},(e,s)=>{if(e)return t.status(400).json({message:e});const r=K.a.sign(s[0].toJSON(),I.secretOrKey);return t.status(200).json({user:s,token:r})})(e,t)};var N=(e,t)=>{M(e,t)},G=(e,t)=>{y.a.authenticate("github",{scope:["user: email"]})(e,t)},H=(e,t)=>{z(e,t)},J=(e,t)=>{y.a.authenticate("apple")(e,t)},$=(e,t)=>{F(e,t)};var W={getMilestoneFromDB:async()=>{try{return await O.a.milestone.findAll()}catch(e){throw new Error(e)}},deleteMilestoneFromDB:async e=>{try{return await O.a.history.destroy({where:{mid:e}}),!0}catch(e){throw new Error(e)}},editMilestoneFromDB:async(e,t)=>{try{let s=await O.a.milestone.findByPk(e);return s={...s,...t},await s.save(),!0}catch(e){throw new Error(e)}},addMilestoneToDB:async e=>{let t;try{t=await O.a.milestone.create(e)}catch(e){throw new Error(e)}return t}};var Y=async(e,t)=>{try{const e=await W.getMilestoneFromDB();return t.status(200).json(e)}catch(e){return t.status(400).json({message:e})}},Z=async(e,t)=>{try{return await W.deleteMilestonFromDB(e.params.id),t.status(200).end()}catch(e){return t.status(400).json({message:e})}},V=async(e,t)=>{const{body:s}=e;try{await W.editMilestoneFromDB(e.params.id,s)}catch(e){t.status(400).json({message:e})}return t.status(200).end()},Q=async(e,t)=>{const{body:s}=e;let r;try{r=await W.addMilestoneToDB(s)}catch(e){t.status(400).json({message:e})}return t.status(200).json(r)};var X={getTargetIssue:async e=>{try{return await O.a.issue.findOne({where:{iid:e}})}catch(e){throw new Error(e)}},getIssues:async e=>{try{if(!e){return await O.a.issue.findAll({include:[O.a.label,O.a.user]})}const t=e>1?10*(e-1):0;return await O.a.issue.findAll({offset:t,limit:10})}catch(e){throw new Error(e)}},createIssue:async(e,t)=>{try{const s=await O.a.issue.create({...e,uid:t});if(e.labels){const t=await O.a.label.findAll({where:{[O.a.Sequelize.Op.or]:e.labels}});await s.addLabels(t,{through:{selfGranted:!0}})}if(e.assignees){const t=await O.a.user.findAll({where:{[O.a.Sequelize.Op.or]:e.assignees}});await s.addUsers(t,{through:{selfGranted:!0}})}return s}catch(e){throw new Error(e)}},deleteIssue:async e=>{try{await O.a.issue.destroy({where:{iid:e}})}catch(e){throw new Error(e)}}};var ee=async(e,t)=>{const{page:s}=e.query;try{const e=await X.getIssues(s);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},te=async(e,t)=>{const s=e.params.id;try{const e=await X.getIssue(s);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},se=async(e,t)=>{const{body:s}=e,{uid:r}=e.user;try{const e=await X.createIssue(s,r);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},re=async(e,t)=>{const s=e.params.id;try{return await X.deleteIssue(s),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},ae=y.a.authenticate("jwt",{session:!1});var ne=async e=>{try{return await O.a.comment.findByPk(e)}catch(e){throw new Error(e)}},oe=async e=>{try{return O.a.comment.findAll({where:{iid:e}})}catch(e){throw new Error(e)}},ce=async(e,t,s,r)=>{try{await O.a.comment.create({nickname:e,content:t,uid:s,iid:r})}catch(e){throw new Error(e)}},ie=async(e,t)=>{try{await O.a.comment.update({content:e},{where:{cid:t}})}catch(e){throw new Error(e)}},ue=async e=>{try{await O.a.comment.destroy({where:{cid:e}})}catch(e){throw new Error(e)}};var le=async(e,t)=>{const{iid:s}=e.params;try{const e=await oe(s);return t.status(200).json(e)}catch(e){throw new Error(e)}},de=async(e,t)=>{const{nickname:s,content:r,iid:a}=e.body,{uid:n}=e.user;try{return await ce(s,r,n,a),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},pe=async(e,t)=>{const{cid:s}=e.params,{content:r}=e.body;try{return await ie(r,s),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},we=async(e,t)=>{const{cid:s}=e.params;try{return await ue(s),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}};var ye=async(e,t,s)=>{const{cid:r}=e.params,{uid:a}=e.user;try{if((await ne(r)).uid!==a)return t.status(400).json({message:"댓글을 쓴 사용자가 아닙니다."})}catch(e){return t.status(400).json(e)}s()};var he=async(e,t,s)=>{try{if(await O.a.label.findByPk(e))throw new Error("이미 존재하는 이름입니다.");await O.a.label.create({name:e,desc:t,color:s})}catch(e){throw new Error(e)}},me=async()=>{try{return O.a.label.findAll()}catch(e){throw new Error(e)}},fe=async e=>{try{return await O.a.label.findOne({where:{name:e}})}catch(e){throw new Error(e)}},ge=async(e,t,s,r)=>{try{if(await O.a.label.findByPk(t))throw new Error("이미 존재하는 이름입니다.");await O.a.label.update({name:t,desc:s,color:r},{where:{name:e}})}catch(e){throw new Error(e)}},be=async e=>{try{await O.a.label.destroy({where:{name:e}})}catch(e){throw new Error(e)}};var ve=async(e,t)=>{const{name:s,desc:r,color:a}=e.body;try{return await he(s,r,a),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},je=async(e,t)=>{try{const e=await me();return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},Ee=async(e,t)=>{const{name:s}=e.params;try{const e=await fe(s);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},Oe=async(e,t)=>{const s=e.params.name,{name:r,desc:a,color:n}=e.body;try{return await ge(s,r,a,n),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},Ae=async(e,t)=>{const{name:s}=e.params;try{return await be(s),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}};var Se=async e=>{const t=(async e=>{const{uid:t,mid:s}=e,r={uid:t,mid:s};Object.keys(r).forEach(e=>void 0===r[e]?delete r[e]:{});return(await O.a.issue.findAll({attributes:["iid"],where:r})).map(e=>e.iid)})(e),s=(async e=>{if(!e)return[];const t=await O.a.label.findAll({where:{[O.a.Sequelize.Op.or]:e},include:[{model:O.a.issue,attributes:["iid"]}]}),s=new Set;t.forEach(e=>e.issues.forEach(e=>s.add(e.iid)));return Array.from(s)})(e.labels),r=(async e=>{if(!e)return[];const t=await O.a.user.findAll({where:{[O.a.Sequelize.Op.or]:e},include:[{model:O.a.issue,attributes:["iid"]}]}),s=new Set;t.forEach(e=>e.issues.forEach(e=>s.add(e.iid)));return Array.from(s)})(e.assignees),[a,n,o]=await Promise.all([t,s,r]),c=new Set([...a,...n,...o]),i=Array.from(c);return O.a.issue.findAll({where:{iid:{[O.a.Sequelize.Op.or]:i}},include:[O.a.label,O.a.user]})};var Ie=async(e,t)=>{const s=await Se(e.body);return t.status(200).json(s)},_e=s(18),qe=s.n(_e),Re=s(19),ke=s.n(Re);var xe=async(e,t)=>t.status(200).json({link:e.file.data.link}),De=()=>{const e=Object(r.Router)();return(e=>{const t=Object(r.Router)(),s=qe()({storage:ke()({clientId:"fa16234a61b3af6"})});e.use("/image",t),t.post("/upload",s.single("img"),xe)})(e),(e=>{const t=Object(r.Router)();e.use("/login",t),t.post("/",N),t.get("/github",G),t.get("/github/callback",H),t.get("/apple",J),t.get("/apple/callback",$)})(e),(e=>{const t=Object(r.Router)();e.use("/signup",t),t.post("/check-id",B,T),t.post("/",C,B,L)})(e),(e=>{const t=Object(r.Router)();e.use("/milestone",t),t.get("/",Y),t.delete("/:id",Z),t.patch("/:id",V),t.post("/",Q)})(e),(e=>{const t=Object(r.Router)();e.use("/issue",t),t.get("/",ee),t.get("/:id",te),t.post("/",se),t.delete("/:id",re)})(e),(e=>{const t=Object(r.Router)();e.use("/comment",t),t.use(ae),t.get("/:iid",le),t.post("/",de),t.patch("/:cid",ye,pe),t.delete("/:cid",ye,we)})(e),(e=>{const t=Object(r.Router)();e.use("/label",t),t.post("/",ve),t.get("/",je),t.get("/:name",Ee),t.patch("/:name",Oe),t.delete("/:name",Ae)})(e),(e=>{const t=Object(r.Router)();e.use("/filter",t),t.use(ae),t.post("/list"),t.post("/search",Ie)})(e),e};if(b.a.config().error)throw new Error(" Couldn't find .env file ");var Pe={prefix:"/api",corsOption:{origin:process.env.CORS,credentials:!0}},Ce=async e=>{e.use(p()("dev")),e.use(i()(Pe.corsOption)),e.use(Object(r.json)()),e.use(Object(r.urlencoded)({extended:!1})),e.use(o()()),(e=>{e.use(y.a.initialize()),y.a.use(A),y.a.use(q),y.a.use(R),y.a.use(x),console.log("🍗 passport Connect! 🍗")})(e),e.get("/status",(e,t)=>t.status(200).end()),e.use(Pe.prefix,De()),e.use((e,t,s)=>s(l()(404,"Not Found"))),e.use((e,t,s,r)=>s.status(e.status).json({message:e.message}))},Be=async e=>{await(async()=>{try{await O.a.sequelize.sync({force:!1})}catch(e){throw new Error(e)}})(),console.log("🎉 DB Connect! 🎉"),await Ce(e),console.log("🍟 Express Connect! 🍟")};if(b.a.config().error)throw new Error(" Couldn't find .env file ");var Te={port:process.env.PORT};(async()=>{const e=a()();await Be(e),e.listen(Te.port,()=>{console.log("Example app listening at http://localhost:"+Te.port)})})()}]);