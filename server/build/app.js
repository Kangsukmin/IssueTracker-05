!function(e){var t={};function s(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=26)}([function(e,t,s){"use strict";s.r(t),function(e){var a=s(18),r=s.n(a),n=s(19),o=s.n(n),u=s(4),i=s.n(u),l=s(20);const c=o.a.basename(e),d=l.a.production,f={},p=new i.a(d.database,d.username,d.password,{host:d.host,port:d.port,dialect:"mysql",timezone:"+09:00"});r.a.readdirSync("./src/models").filter(e=>0!==e.indexOf(".")&&e!==c&&".js"===e.slice(-3)).forEach(e=>{const t=s(25)("./"+e).default(p,i.a.DataTypes);f[t.name]=t}),Object.keys(f).forEach(e=>{f[e].associate&&f[e].associate(f)}),f.sequelize=p,f.Sequelize=i.a,t.default=f}.call(this,"/index.js")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("passport-jwt")},function(e,t,s){"use strict";s.r(t),t.default=(e,t)=>{const s=e.define("comment",{cid:{type:t.INTEGER,allowNull:!1,primaryKey:!0,autoIncrement:!0},content:{type:t.TEXT,allowNull:!1}},{tableName:"comment",underscored:!0});return s.associate=e=>{s.belongsTo(e.user,{foreignKey:{name:"uid",allowNull:!1}}),s.belongsTo(e.issue,{foreignKey:{name:"iid",allowNull:!1}})},s}},function(e,t,s){"use strict";s.r(t),t.default=(e,t)=>{const s=e.define("issue",{iid:{type:t.INTEGER,allowNull:!1,primaryKey:!0,autoIncrement:!0},isOpen:{type:t.BOOLEAN,allowNull:!1,defaultValue:!0},title:{type:t.STRING,allowNull:!1},content:{type:t.TEXT,allowNull:!0}},{tableName:"issue",underscored:!0});return s.associate=e=>{s.belongsTo(e.milestone,{foreignKey:{name:"mid",allowNull:!0}}),s.hasMany(e.comment,{foreignKey:{name:"iid",allowNull:!1}}),s.belongsToMany(e.user,{through:"issue_assignee"}),s.belongsToMany(e.label,{through:"issue_label"})},s}},function(e,t,s){"use strict";s.r(t),t.default=(e,t)=>{const s=e.define("label",{name:{type:t.STRING,allowNull:!1,primaryKey:!0},color:{type:t.STRING,allowNull:!1},desc:{type:t.STRING,allowNull:!0}},{tableName:"label",underscored:!0});return s.associate=e=>{s.belongsToMany(e.issue,{through:"issue_label"})},s}},function(e,t,s){"use strict";s.r(t),t.default=(e,t)=>{const s=e.define("milestone",{mid:{type:t.INTEGER,allowNull:!1,autoIncrement:!0,primaryKey:!0},isOpen:{type:t.BOOLEAN,allowNull:!1,defaultValue:!0},title:{type:t.STRING,allowNull:!1},dueDate:{type:t.DATE,allowNull:!0},content:{type:t.TEXT,allowNull:!0}},{tableName:"milestone",underscored:!0});return s.associate=e=>{s.hasMany(e.issue,{foreignKey:{name:"mid",allowNull:!0}})},s}},function(e,t,s){"use strict";s.r(t),t.default=(e,t)=>{const s=e.define("user",{uid:{type:t.INTEGER,allowNull:!1,autoIncrement:!0,primaryKey:!0},userId:{type:t.STRING,allowNull:!1},password:{type:t.STRING,allowNull:!0},nickname:{type:t.STRING,allowNull:!1},OAuth:{type:t.BOOLEAN,allowNull:!1},resourceServer:{type:t.STRING,allowNull:!1}},{tableName:"user",underscored:!0});return s.associate=e=>{s.hasMany(e.comment,{foreignKey:{name:"uid",allowNull:!1}}),s.hasMany(e.issue,{foreignKey:{name:"uid",allowNull:!1}}),s.belongsToMany(e.issue,{through:"issue_assignee"})},s}},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("http-errors")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t,s){"use strict";var a=s(3);if(s.n(a).a.config().error)throw new Error("Could't find .env file ");t.a={development:{host:process.env.DB_HOST,port:process.env.DB_PORT,username:process.env.DB_USERNAME,password:process.env.DB_PASSWORD,database:process.env.DB_DATABASE,dialect:"mysql"},test:{username:"root",password:null,database:"database_production",host:"127.0.0.1",dialect:"mysql"},production:{username:"root",password:null,database:process.env.DB_DATABASE,host:"127.0.0.1",dialect:"mysql"}}},function(e,t){e.exports=require("passport-github2")},function(e,t){e.exports=require("passport-apple")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("multer-storage-imgur")},function(e,t,s){var a={"./":0,"./comment":8,"./comment.js":8,"./index":0,"./index.js":0,"./issue":9,"./issue.js":9,"./label":10,"./label.js":10,"./milestone":11,"./milestone.js":11,"./user":12,"./user.js":12};function r(e){var t=n(e);return s(t)}function n(e){if(!s.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=n,e.exports=r,r.id=25},function(e,t,s){"use strict";s.r(t);var a=s(1),r=s.n(a),n=s(13),o=s.n(n),u=s(14),i=s.n(u),l=s(15),c=s.n(l),d=s(16),f=s.n(d),p=s(2),w=s.n(p),y=s(17),m=s(6),h=s.n(m),g=s(3),b=s.n(g);if(b.a.config().error)throw new Error(" Couldn't find .env file ");var j={saltRounds:+process.env.SALT_ROUNDS};var v=e=>new Promise((t,s)=>{h.a.hash(e,j.saltRounds,(e,s)=>t(s))}),E=(e,t)=>new Promise((s,a)=>{h.a.compare(e,t,(e,t)=>s(t))}),O=s(0);var N=new y.Strategy({usernameField:"userId",passwordField:"password",session:!1},async(e,t,s)=>{const a=await O.default.user.findOne({where:{userId:e}});if(!a)return s(null,!1,{message:"찾는 아이디가 없습니다."});return await E(t,a.password)?s(null,a):s(null,!1,{message:"비밀번호가 다릅니다."})}),S=s(7);if(b.a.config().error)throw new Error(" Couldn't find .env file ");var I={secretOrKey:process.env.JWT_SECRET_KEY,githubClientId:process.env.GITHUB_ID,githubClientSecret:process.env.GITHUB_SECRET,githubCallbackURL:process.env.GITHUB_CALLBACK_URL,appleClientId:process.env.APPLE_CLIENT_ID,appleTeamId:process.env.APPLE_TEAM_ID,appleKeyId:process.env.APPLE_KEY_ID,applePrivateKey:process.env.APPLE_PRIVATE_KEY,appleCallbackURL:process.env.APPLE_CALLBACK_URL};const T={jwtFromRequest:S.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:I.secretOrKey};var A=new S.Strategy(T,async(e,t)=>{try{const s=await O.default.user.findOne({where:{userId:e.userId,resourceServer:e.resourceServer}});return t(null,s?s:!1)}catch(e){return t(e,!1)}}),R=new(s(21).Strategy)({clientID:I.githubClientId,clientSecret:I.githubClientSecret,callbackURL:I.githubCallbackURL},async(e,t,s,a)=>a(null,await O.default.user.findOrCreate({where:{userId:s.id,resourceServer:s.provider,nickname:s.username,OAuth:!0}}))),_=s(22),q=new(s.n(_).a)({clientID:I.appleClientId,teamID:I.appleTeamId,callbackURL:I.appleCallbackURL,keyID:I.appleKeyId,privateKeyLocation:I.applePrivateKey,passReqToCallback:!0},async(e,t,s,a,r,n)=>n(null,await O.default.user.findOrCreate({where:{userId:r.id,resourceServer:"apple",nickname:r.username,OAuth:!0}})));var x=async e=>!await O.default.user.findOne({where:{userId:e}}),k=async(e,t,s)=>{try{const a=await v(t);return await O.default.user.create({userId:""+e,nickname:""+s,password:""+a,OAuth:!1,resourceServer:"local"})}catch(e){throw new Error(e)}};var D=(e,t,s)=>{const{userId:a,password:r,nickname:n}=e.body;if(a.length<6)return t.status(400).json({message:"아이디는 6자 이상 적어주셔야 합니다."});if(a.length>16)return t.status(400).json({message:"아이디는 16자 이하로 적어주셔야 합니다."});if(n.length<6)return t.status(400).json({message:"닉네임은 6자 이상 적어주셔야 합니다."});if(n.length>16)return t.status(400).json({message:"닉네임 16자 이하로 적어주셔야 합니다."});if(r.length<6)return t.status(400).json({message:"비밀번호는 6자 이상 적어주셔야 합니다."});if(r.length>12)return t.status(400).json({message:"비밀번호는 12자 이하로 적어주셔야 합니다."});const o=/[a-zA-Z0-9]/;return o.test(a)?o.test(n)?/[0-9]/.test(r)&&/[a-zA-Z]/.test(r)&&/[~!@#$%^&*()_+|<>?:{}]/.test(r)?void s():t.status(400).json({message:"비밀번호는 영문자, 숫자, 특수문자로 구성되어야 합니다."}):t.status(400).json({message:"닉네임은 영문과 숫자로만 적어주셔야 합니다."}):t.status(400).json({message:"아이디는 영문과 숫자로만 적어주셔야 합니다."})},C=async(e,t,s)=>{const{userId:a}=e.body;if(!await x(a))return t.status(400).json({message:"아이디가 이미 존재합니다."});s()};var B=(e,t)=>t.status(200),K=async(e,t)=>{const{userId:s,password:a,nickname:r}=e.body;try{const e=await k(s,a,r);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},P=s(5),L=s.n(P);var M=(e,t)=>{w.a.authenticate("local",{session:!1},(s,a,r)=>s||!a?t.status(400).json(r):e.login(a,{session:!1},e=>{e&&t.send(e);const s=L.a.sign(a.toJSON(),I.secretOrKey);return t.json({user:a,token:s})}))(e,t)},G=(e,t)=>{w.a.authenticate("apple",{session:!1},(e,s)=>{if(e)return t.status(400).json({message:e});const a=L.a.sign(s[0].toJSON(),I.secretOrKey);return t.status(200).json({user:s,token:a})})(e,t)};var z=(e,t)=>{M(e,t)},U=(e,t)=>{w.a.authenticate("github",{scope:["user: email"]})(e,t)},F=(e,t)=>{t.redirect("/")},H=(e,t)=>{w.a.authenticate("apple")(e,t)},J=(e,t)=>{G(e,t)};var V={getMilestoneFromDB:async()=>{try{return await O.default.milestone.findAll({include:[{model:O.default.issue,attributes:["isOpen"]}]})}catch(e){throw new Error(e)}},deleteMilestoneFromDB:async e=>{try{return await O.default.history.destroy({where:{mid:e}}),!0}catch(e){throw new Error(e)}},editMilestoneFromDB:async(e,t)=>{try{return await O.default.milestone.update(t,{where:{mid:e}})}catch(e){throw new Error(e)}},addMilestoneToDB:async e=>{let t;try{t=await O.default.milestone.create(e)}catch(e){throw new Error(e)}return t}};var X=async(e,t)=>{try{const e=await V.getMilestoneFromDB();return t.status(200).json(e)}catch(e){return t.status(400).json({message:e})}},Y=async(e,t)=>{try{return await V.deleteMilestonFromDB(e.params.id),t.status(200).end()}catch(e){return t.status(400).json({message:e})}},W=async(e,t)=>{const{body:s}=e;try{await V.editMilestoneFromDB(e.params.id,s)}catch(e){t.status(400).json({message:e})}return t.status(200).end()},Z=async(e,t)=>{const{body:s}=e;let a;try{a=await V.addMilestoneToDB(s)}catch(e){t.status(400).json({message:e})}return t.status(200).json(a)},$=w.a.authenticate("jwt",{session:!1});const Q=async e=>{try{return await O.default.issue.findOne({where:{iid:e},include:O.default.comment})}catch(e){throw new Error(e)}};var ee=Q,te=async e=>{try{if(!e){return await O.default.issue.findAll({include:[O.default.label,O.default.user]})}const t=e>1?10*(e-1):0;return await O.default.issue.findAll({offset:t,limit:10})}catch(e){throw new Error(e)}},se=async(e,t)=>{try{const s=await O.default.issue.create({...e,uid:t});if(e.labels){const t=await O.default.label.findAll({where:{[O.default.Sequelize.Op.or]:e.labels}});await s.addLabels(t,{through:{selfGranted:!0}})}if(e.assignees){const t=await O.default.user.findAll({where:{[O.default.Sequelize.Op.or]:e.assignees}});await s.addUsers(t,{through:{selfGranted:!0}})}return s}catch(e){throw new Error(e)}},ae=async e=>{try{await O.default.issue.destroy({where:{iid:e}})}catch(e){throw new Error(e)}},re=async(e,t)=>{try{if(e){await O.default.issue.update({...e},{where:{iid:t}});const{labels:s,assignees:a}=e;if(s||a){const e=await Q(t);if(s){const[a,r]=s.reduce((e,t)=>(t.state?(delete t.state,e[0].push(t)):e[1].push(t.name),e),[[],[]]);if(a.length){const t=await O.default.label.findAll({where:{[O.default.Sequelize.Op.or]:a}});await e.addLabels(t,{through:{selfGranted:!0}})}r.length&&await O.default.sequelize.models.issue_label.destroy({where:{issue_iid:t,label_name:{[O.default.Sequelize.Op.or]:r}}})}if(a){const[s,r]=a.reduce((e,t)=>(t.state?(delete t.state,e[0].push(t)):e[1].push(t.uid),e),[[],[]]);if(s.length){const t=await O.default.user.findAll({where:{[O.default.Sequelize.Op.or]:s}});await e.addUsers(t,{through:{selfGranted:!0}})}r.length&&await O.default.sequelize.models.issue_assignee.destroy({where:{issue_iid:t,user_uid:{[O.default.Sequelize.Op.or]:r}}})}}return!0}}catch(e){throw new Error(e)}};var ne=async(e,t)=>{const{page:s}=e.query;try{const e=await te(s);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},oe=async(e,t)=>{const s=e.params.id;try{const e=await ee(s);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},ue=async(e,t)=>{const{body:s}=e,{uid:a}=e.user;try{const e=await se(s,a);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},ie=async(e,t)=>{const s=e.params.id,{body:a}=e;try{const e=await re(a,s);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},le=async(e,t)=>{const s=e.params.id;try{return await ae(s),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}};var ce=async e=>{try{return await O.default.comment.findByPk(e)}catch(e){throw new Error(e)}},de=async e=>{try{return O.default.comment.findAll({where:{iid:e}})}catch(e){throw new Error(e)}},fe=async(e,t,s,a)=>{try{await O.default.comment.create({nickname:e,content:t,uid:s,iid:a})}catch(e){throw new Error(e)}},pe=async(e,t)=>{try{await O.default.comment.update({content:e},{where:{cid:t}})}catch(e){throw new Error(e)}},we=async e=>{try{await O.default.comment.destroy({where:{cid:e}})}catch(e){throw new Error(e)}};var ye=async(e,t)=>{const{iid:s}=e.params;try{const e=await de(s);return t.status(200).json(e)}catch(e){throw new Error(e)}},me=async(e,t)=>{const{nickname:s,content:a,iid:r}=e.body,{uid:n}=e.user;try{return await fe(s,a,n,r),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},he=async(e,t)=>{const{cid:s}=e.params,{content:a}=e.body;try{return await pe(a,s),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},ge=async(e,t)=>{const{cid:s}=e.params;try{return await we(s),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}};var be=async(e,t,s)=>{const{cid:a}=e.params,{uid:r}=e.user;try{if((await ce(a)).uid!==r)return t.status(400).json({message:"댓글을 쓴 사용자가 아닙니다."})}catch(e){return t.status(400).json(e)}s()};var je=async(e,t,s)=>{try{if(await O.default.label.findByPk(e))throw new Error("이미 존재하는 이름입니다.");await O.default.label.create({name:e,desc:t,color:s})}catch(e){throw new Error(e)}},ve=async()=>{try{return O.default.label.findAll()}catch(e){throw new Error(e)}},Ee=async e=>{try{return await O.default.label.findOne({where:{name:e}})}catch(e){throw new Error(e)}},Oe=async(e,t,s,a)=>{try{if(await O.default.label.findByPk(t))throw new Error("이미 존재하는 이름입니다.");await O.default.label.update({name:t,desc:s,color:a},{where:{name:e}})}catch(e){throw new Error(e)}},Ne=async e=>{try{await O.default.label.destroy({where:{name:e}})}catch(e){throw new Error(e)}};var Se=async(e,t)=>{const{name:s,desc:a,color:r}=e.body;try{return await je(s,a,r),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},Ie=async(e,t)=>{try{const e=await ve();return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},Te=async(e,t)=>{const{name:s}=e.params;try{const e=await Ee(s);return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},Ae=async(e,t)=>{const s=e.params.name,{name:a,desc:r,color:n}=e.body;try{return await Oe(s,a,r,n),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}},Re=async(e,t)=>{const{name:s}=e.params;try{return await Ne(s),t.status(200).end()}catch(e){return t.status(400).json({message:e.message})}};var _e=async e=>{const t=(async e=>{const{uid:t,mid:s}=e,a={uid:t,mid:s};Object.keys(a).forEach(e=>void 0===a[e]?delete a[e]:{});return(await O.default.issue.findAll({attributes:["iid"],where:a})).map(e=>e.iid)})(e),s=(async e=>{if(!e)return[];const t=await O.default.label.findAll({where:{[O.default.Sequelize.Op.or]:e},include:[{model:O.default.issue,attributes:["iid"]}]}),s=new Set;t.forEach(e=>e.issues.forEach(e=>s.add(e.iid)));return Array.from(s)})(e.labels),a=(async e=>{if(!e)return[];const t=await O.default.user.findAll({where:{[O.default.Sequelize.Op.or]:e},include:[{model:O.default.issue,attributes:["iid"]}]}),s=new Set;t.forEach(e=>e.issues.forEach(e=>s.add(e.iid)));return Array.from(s)})(e.assignees),[r,n,o]=await Promise.all([t,s,a]),u=new Set([...r,...n,...o]),i=Array.from(u);return O.default.issue.findAll({where:{iid:{[O.default.Sequelize.Op.or]:i}},include:[O.default.label,O.default.user]})};var qe=async(e,t)=>{const s=await _e(e.body);return t.status(200).json(s)},xe=s(23),ke=s.n(xe),De=s(24),Ce=s.n(De);var Be=async(e,t)=>t.status(200).json({link:e.file.data.link});var Ke=async()=>{try{return O.default.user.findAll({attributes:["uid","userId","nickname"]})}catch(e){throw new Error(e)}};var Pe=async(e,t)=>{try{const e=await Ke();return t.status(200).json(e)}catch(e){return t.status(400).json({message:e.message})}},Le=()=>{const e=Object(a.Router)();return(e=>{const t=Object(a.Router)(),s=ke()({storage:Ce()({clientId:"fa16234a61b3af6"})});e.use("/image",t),t.use($),t.post("/upload",s.single("img"),Be)})(e),(e=>{const t=Object(a.Router)();e.use("/login",t),t.post("/",z),t.get("/github",U),t.get("/github/callback",w.a.authenticate("github",{failureRedirect:"/login",session:!1}),F),t.get("/apple",H),t.get("/apple/callback",J)})(e),(e=>{const t=Object(a.Router)();e.use("/signup",t),t.post("/check-id",C,B),t.post("/",D,C,K)})(e),(e=>{const t=Object(a.Router)();e.use("/milestone",t),t.use($),t.get("/",X),t.delete("/:id",Y),t.patch("/:id",W),t.post("/",Z)})(e),(e=>{const t=Object(a.Router)();e.use("/issue",t),t.use($),t.get("/",ne),t.get("/:id",oe),t.post("/",ue),t.patch("/:id",ie),t.delete("/:id",le)})(e),(e=>{const t=Object(a.Router)();e.use("/comment",t),t.use($),t.get("/:iid",ye),t.post("/",me),t.patch("/:cid",be,he),t.delete("/:cid",be,ge)})(e),(e=>{const t=Object(a.Router)();e.use("/label",t),t.use($),t.post("/",Se),t.get("/",Ie),t.get("/:name",Te),t.patch("/:name",Ae),t.delete("/:name",Re)})(e),(e=>{const t=Object(a.Router)();e.use("/filter",t),t.use($),t.post("/list"),t.post("/search",qe)})(e),(e=>{const t=Object(a.Router)();e.use("/user",t),t.get("/",Pe)})(e),e};if(b.a.config().error)throw new Error(" Couldn't find .env file ");var Me={prefix:"/api",corsOption:{origin:process.env.CORS,credentials:!0}},Ge=async e=>{e.use(f()("dev")),e.use(i()(Me.corsOption)),e.use(Object(a.json)()),e.use(Object(a.urlencoded)({extended:!1})),e.use(o()()),(e=>{e.use(w.a.initialize()),w.a.use(N),w.a.use(A),w.a.use(R),w.a.use(q),console.log("🍗 passport Connect! 🍗")})(e),e.get("/status",(e,t)=>t.status(200).end()),e.use(Me.prefix,Le()),e.use((e,t,s)=>s(c()(404,"Not Found"))),e.use((e,t,s,a)=>s.status(e.status).json({message:e.message}))},ze=async e=>{await(async()=>{try{await O.default.sequelize.sync({force:!1})}catch(e){throw new Error(e)}})(),console.log("🎉 DB Connect! 🎉"),await Ge(e),console.log("🍟 Express Connect! 🍟")};if(b.a.config().error)throw new Error(" Couldn't find .env file ");var Ue={port:process.env.PORT};(async()=>{const e=r()();await ze(e),e.listen(Ue.port,()=>{console.log("Example app listening at http://localhost:"+Ue.port)})})()}]);